class_name EntityManager
extends Node2D



## Entity Manager is to be a child of the UserInteractableTileMapLayer
## This allows access to the path generated by the pathing component
##
## Add entities as children of this node
##
## This script is used to spawn entities and send them down the path.
## Also keeps track of entities


# pre-load scenes for enemy types
@onready var enemy_type: Dictionary = {
	"BaseEntity": preload("res://Scenes/Components/Entities/BaseEntity.tscn"),
	"OtherEntity": preload("res://Scenes/Components/Entities/OtherEntity.tscn"),
	"KnightEntity": preload("../../Scenes/Components/Entities/KnightEntity.tscn"),
}

# set as parent
@onready var userInteractableTileMapLayer: UserInteractableTilemapLayer = $".."

var startCoord: Vector2

# make sure the the path is valid and generated before calling this
func getPath() -> PackedVector2Array:
	return userInteractableTileMapLayer.pathingComponent.getPath()

func spawnAndSendOutEntity() -> void:
	var testEntityInstance: Entity = enemy_type["BaseEntity"].instantiate()
	add_child(testEntityInstance)
	testEntityInstance.configure({"speed": 50})
	# NOTE - need to add to scene first to allow certain variables to initialize
	testEntityInstance.setup(getPath())
	testEntityInstance.startMoving()


## Spawn entity by name
func spawnEntity(name: String, config: Dictionary = {}) -> void:
	var etype = enemy_type[name]
	if etype == null:
		print("".join(["Unknown enemy type: ", name]))
		return
	var instance: Entity = etype.instantiate()
	add_child(instance)
	instance.setup(getPath())
	instance.configure(config)
	instance.startMoving()
